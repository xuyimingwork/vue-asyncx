# withAddonGroup

`withAddonGroup` ç”¨äºç®¡ç†**å¹¶è¡ŒåŒè¯­ä¹‰æ“ä½œ**çš„çŠ¶æ€ã€‚

å½“**åŒä¸€ä¸ªå¼‚æ­¥æ“ä½œ**éœ€è¦å¹¶è¡Œè°ƒç”¨ï¼Œ
`withAddonGroup` å¯ä»¥æ ¹æ® `key` å°†è°ƒç”¨**åˆ†ç»„ç®¡ç†**ï¼Œæ¯ç»„ç»´æŠ¤å„è‡ªçš„å¼‚æ­¥çŠ¶æ€ã€‚

å…¸å‹åœºæ™¯åŒ…æ‹¬ï¼š

- åˆ—è¡¨ä¸­æ¯ä¸€é¡¹éƒ½æœ‰ã€Œç¡®è®¤ / åˆ é™¤ / æäº¤ã€ç­‰æ“ä½œ
- å¤šä¸ª item åŒæ—¶è§¦å‘ç›¸åŒ APIï¼Œä½†éœ€è¦**å„è‡ªç‹¬ç«‹çš„ loading / error / data**
- æ“ä½œåœ¨è¯­ä¹‰ä¸Šæ˜¯â€œåŒä¸€ä¸ªâ€ï¼Œä½†åœ¨ UI ä¸Šæ˜¯â€œå¤šä¸ªå¹¶è¡Œå®ä¾‹â€

## åŸºæœ¬ç”¨æ³•

```ts
const { confirm, confirmGroup } = useAsync(
  'confirm',
  confirmApi,
  {
    addons: [
      withAddonGroup({
        key: (args) => args[0], // ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºåˆ†ç»„ key
      }),
    ],
  }
)
```

åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨

```vue
<template>
  <div v-for="item in items" :key="item.id">
    <button
      :loading="confirmGroup[item.id]?.loading"
      @click="confirm(item.id)"
    >
      {{ confirmGroup[item.id]?.loading ? 'ç¡®è®¤ä¸­...' : 'ç¡®è®¤' }}
    </button>
  </div>
</template>
```

ğŸ‘‰ æ¯ä¸€ä¸ª `item.id` éƒ½ä¼šè‡ªåŠ¨å…³è”ä¸€ä¸ªç‹¬ç«‹çš„ `confirmGroup[item.id]`ï¼Œä¸éœ€è¦ä¸ºæ¯ä¸€é¡¹å•ç‹¬å°è£…å¼‚æ­¥é€»è¾‘ï¼Œä¹Ÿä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†çŠ¶æ€æ˜ å°„ã€‚

## æ•°æ®ç»“æ„

`{name}Group` æ˜¯ä¸€ä¸ª**æŒ‰ key åˆ†ç»„**çš„**å“åº”å¼**æ•°æ®é›†åˆï¼š

```ts
confirmGroup[key]
```

æ¯ä¸ª `{name}Group[key]` å§‹ç»ˆåŒ…å«ä»¥ä¸‹å­—æ®µï¼š

```ts
type GroupType<M extends (...args: any[]) => any> = {
  loading: boolean
  error: any
  arguments: Parameters<M> | undefined
  argumentFirst: Parameters<M>['0'] | undefined
  data: Awaited<ReturnType<M>> | undefined
  dataExpired: boolean
}
```

### ç‰¹ç‚¹è¯´æ˜

`{name}Group[key]` æ˜¯æŒ‰éœ€ç”Ÿæˆçš„ã€‚å¦‚æœæŸä¸ª key ä»æœªè¢«è°ƒç”¨è¿‡æ—¶ï¼Œ`{name}Group[key]` ä¸º `undefined`ï¼Œå› æ­¤è®¿é—®æ—¶éœ€è¦ä½¿ç”¨å¯é€‰é“¾ `?.`

```ts
// âœ… æ­£ç¡®
confirmGroup[item.id]?.loading

// âŒ é”™è¯¯ï¼ˆkey å¯èƒ½å°šæœªå­˜åœ¨ï¼‰
confirmGroup[item.id].loading
```

> è¦æ¬ºéª— ts `{name}Group` åŒ…å«æ‰€æœ‰ `key` å¾ˆå›°éš¾ï¼Œä¼šé€ æˆç±»å‹ä¸å®ç°ä¸ä¸€è‡´ï¼Œæ‰€ä»¥ç»Ÿä¸€é€šè¿‡å¯é€‰é“¾è®¿é—®

## æ’ä»¶ç‰¹æ€§

### 1. è‡ªåŠ¨åˆ›å»ºä¸åŒæ­¥

- å½“å¼‚æ­¥å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå¯¹åº”çš„ `{name}Group[key]` ä¼šè‡ªåŠ¨åˆ›å»º
- ç¬¦åˆè¯¥åˆ†ç»„çš„è¯·æ±‚çŠ¶æ€ï¼ˆloading / error / dataï¼‰ä¼šè‡ªåŠ¨åŒæ­¥åˆ° `{name}Group[key]`

### 2. è‡ªåŠ¨å¤„ç†ç«æ€

- ç«æ€é€»è¾‘ä¸æœªåˆ†ç»„æ—¶çš„é€»è¾‘å®Œå…¨ä¸€è‡´
- æ— éœ€é¢å¤–é…ç½®å³å¯é¿å…ç«æ€é—®é¢˜

## è¿›é˜¶ï¼šå¦‚ä½•è¿›è¡Œå†…å­˜é‡Šæ”¾ï¼Ÿ

åœ¨**ç»„ä»¶å†…ä½¿ç”¨**ï¼ˆéå…¨å±€å•ä¾‹ã€éæ ¹ç»„ä»¶ï¼‰æ—¶ï¼Œç»„ä»¶å¸è½½ä¼šè‡ªåŠ¨å¸è½½æ‰€æœ‰å…³è”å˜é‡ã€‚æ‰€ä»¥ï¼š

âš ï¸ **å¤§å¤šæ•°åœºæ™¯ä¸éœ€è¦å…³å¿ƒå†…å­˜é—®é¢˜**

åªæœ‰åœ¨ä»¥ä¸‹æƒ…å†µä¹‹ä¸€æˆç«‹æ—¶ï¼Œæ‰å»ºè®®è€ƒè™‘å®ƒï¼š

- å¼‚æ­¥çŠ¶æ€å­˜åœ¨äº**å…¨å±€æˆ–é•¿ç”Ÿå‘½å‘¨æœŸç»„ä»¶**ä¸­ï¼Œä¸”åˆ†ç»„ key ä¼šæŒç»­å¢é•¿ï¼ˆä¾‹å¦‚**é•¿æ—¶é—´å­˜åœ¨**çš„åˆ†é¡µã€æ— é™æ»šåŠ¨é¡µé¢ï¼‰
- ä½ å¸Œæœ›åœ¨ã€Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€æ—¶ï¼Œ**ä¸»åŠ¨æ¸…ç†æ—§åˆ†ç»„**

æ­¤æ—¶ï¼Œéšç€ `key` æ•°é‡å¢é•¿ï¼Œ`{name}Group` ä¼šéšä¹‹å¢åŠ ã€‚

### å…¸å‹åœºæ™¯ï¼šåˆ†é¡µ

```ts
const page = ref(1)

const { queryItem, itemGroup } = useAsyncData(
  'item',
  getItemApi,
  {
    addons: [
      withAddonGroup({
        key: (args) => args[0],   // itemId
        scope: () => page.value, // å½“å‰é¡µä½œä¸ºä½œç”¨åŸŸ
      }),
    ],
  }
)
```

å½“ `page` å˜åŒ–æ—¶ï¼š

- ä¸Šä¸€ä¸ª page ä¸‹çš„æ‰€æœ‰ `{name}Group[key]` ä¼šè¢«è‡ªåŠ¨æ¸…ç†
- ç”¨äºé˜²æ­¢é•¿æœŸå­˜åœ¨çš„çŠ¶æ€æŒç»­ç´¯ç§¯

> `scope` ä¸æ˜¯ç”¨äºåŒºåˆ†è¯·æ±‚ï¼Œè€Œæ˜¯ç”¨äºå®šä¹‰è¿™äº›åˆ†ç»„ä½•æ—¶æ•´ä½“å¤±æ•ˆã€‚

### æ‰‹åŠ¨æ¸…ç†

```ts
const {
  confirm,
  confirmGroup,
  clearConfirmGroup,
} = useAsync(
  'confirm',
  confirmApi,
  {
    addons: [withAddonGroup({ key: (args) => args[0] })],
  }
)
```

```ts
// æ¸…ç†æŒ‡å®š key
clearConfirmGroup('item1')

// æ¸…ç†å…¨éƒ¨ group
clearConfirmGroup()
```

> å³ä½¿åœ¨è¯·æ±‚å°šæœªç»“æŸæ—¶æ¸…ç†ï¼Œ
> è¯·æ±‚å®Œæˆåä¹Ÿä¸ä¼šé‡æ–°åˆ›å»ºå¯¹åº”çš„ groupã€‚

### å¿ƒæ™ºæ¨¡å‹

å…³äºå†…å­˜é‡Šæ”¾ï¼Œè®°ä½è¿™ä¸¤å¥è¯å°±å¤Ÿäº†ï¼š

- **key**ï¼šåŒºåˆ† *å¹¶è¡Œå®ä¾‹*
- **scope**ï¼šå®šä¹‰ *è¿™äº›å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸè¾¹ç•Œ*

å¦‚æœä½ æ²¡æœ‰æ˜ç¡®çš„ç”Ÿå‘½å‘¨æœŸè¾¹ç•Œé—®é¢˜ï¼Œ
**åªç”¨ keyï¼Œå°±å·²ç»è¦†ç›–äº† 90% çš„ä½¿ç”¨åœºæ™¯ã€‚**